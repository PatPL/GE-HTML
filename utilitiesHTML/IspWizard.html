<meta charset="UTF-8" />
<script src="../js/index.js"></script>
<body style="filter: invert(0.9); background: #111; font-family: Verdana;">
    Efficiency %:
    <table>
        <tr>
            <th>Low SL</th>
            <th>High SL</th>
            <th>Low Vac</th>
            <th>High Vac</th>
        </tr>
        <tr>
            <td><input id="ls" value="84"></td>
            <td><input id="hs" value="90"></td>
            <td><input id="lv" value="86"></td>
            <td><input id="hv" value="91"></td>
        </tr>
    </table>

    <table id="output">
        <tr style="display: none" id="template">
            <td>Propmix lll</td>
            <td style="text-align: right;">Impulse lll</td>
            <td>Impulse lll</td>
            <td style="text-align: right;">Impulse lll</td>
            <td>Impulse lll</td>
        </tr>
        <tr>
            <th>Propmix</th>
            <th>Low SL Isp</th>
            <th>High SL Isp</th>
            <th>Low Vac Isp</th>
            <th>High Vac Isp</th>
        </tr>
    </table>
</body>
<script>
    document.addEventListener ("DOMContentLoaded", () => {
        console.info ("Ignore the errors");
        try {
            // Check if the main script loaded these
            PropellantMix;
            PropellantMixList;
        } catch (e) {
            console.warn ("Actually don't ignore them. There was an error in main JS thread, before the propmixes were loaded. Fix it.");
        }
        
        let lowSLInput = document.getElementById ("ls");
        let highSLInput = document.getElementById ("hs");
        let lowVacInput = document.getElementById ("lv");
        let highVacInput = document.getElementById ("hv");
        
        for (let i in PropellantMixList) {
            let mix = PropellantMixList[i];
            let line = document.getElementById ("template").cloneNode (true);
            line.style.display = "table-row";
            
            document.getElementById ("output").children[0].appendChild (line);
            
            line.children[0].innerHTML = PropellantMix[i];
            
            const Update = () => {
                let lowSL = parseFloat (lowSLInput.value);
                let highSL = parseFloat (highSLInput.value);
                let lowVac = parseFloat (lowVacInput.value);
                let highVac = parseFloat (highVacInput.value);
                
                lowVac /= 100;
                lowVac *= mix.MaximumIsp;
                highVac /= 100;
                highVac *= mix.MaximumIsp;
                let medVac = (lowVac + highVac) / 2;
                
                lowSL = 100 - ((100 - lowSL) * mix.SLIspLossCoefficient);
                highSL = 100 - ((100 - highSL) * mix.SLIspLossCoefficient);
                
                let medlowSL = ((lowVac + highVac) / 2) * lowSL / 100;
                let medhighSL = ((lowVac + highVac) / 2) * highSL / 100;
                lowSL /= 100;
                lowSL *= lowVac;
                highSL /= 100;
                highSL *= highVac;
                
                const ROUNDING_FACTOR = 1000;
                medVac = Math.round (medVac * ROUNDING_FACTOR) / ROUNDING_FACTOR;
                medlowSL = Math.round (medlowSL * ROUNDING_FACTOR) / ROUNDING_FACTOR;
                medhighSL = Math.round (medhighSL * ROUNDING_FACTOR) / ROUNDING_FACTOR;
                lowSL = Math.round (lowSL * ROUNDING_FACTOR) / ROUNDING_FACTOR;
                highSL = Math.round (highSL * ROUNDING_FACTOR) / ROUNDING_FACTOR;
                lowVac = Math.round (lowVac * ROUNDING_FACTOR) / ROUNDING_FACTOR;
                highVac = Math.round (highVac * ROUNDING_FACTOR) / ROUNDING_FACTOR;
                
                line.children[1].innerHTML = `${ lowSL }s - <br>Avg: ${ medlowSL }s - `;
                line.children[2].innerHTML = `${ highSL }s<br>${ medhighSL }s`;
                line.children[3].innerHTML = `${ lowVac }s - <br>Avg:`;
                line.children[4].innerHTML = `${ highVac }s<br>${ medVac }s`;
            }
            
            lowSLInput.addEventListener ("input", () => Update ());
            highSLInput.addEventListener ("input", () => Update ());
            lowVacInput.addEventListener ("input", () => Update ());
            highVacInput.addEventListener ("input", () => Update ());
            
            Update ();
        }
    });
</script>